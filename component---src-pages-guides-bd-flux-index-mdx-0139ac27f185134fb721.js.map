{"version":3,"file":"component---src-pages-guides-bd-flux-index-mdx-0139ac27f185134fb721.js","mappings":"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","sources":["webpack://zerthox.github.io/./src/pages/guides/bd/flux/index.mdx"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/zerthox.github.io/zerthox.github.io/src/templates/markdown.tsx\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst Banner = makeShortcode(\"Banner\");\nconst CodeTabs = makeShortcode(\"CodeTabs\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`State management in React`}</h2>\n    <p>{`When working with `}<a parentName=\"p\" {...{\n        \"href\": \"https://reactjs.org\"\n      }}>{`React`}</a>{`, the UI has a state, which determines the elements rendered onscreen.\nChanging said state will cause React to rerender the affected UI components.\nReact itself already comes with some tools to manage state:\nthe `}<a parentName=\"p\" {...{\n        \"href\": \"https://reactjs.org/docs/faq-state.html\"\n      }}>{`State API`}</a>{`,\nwhich can be used via the `}<a parentName=\"p\" {...{\n        \"href\": \"https://reactjs.org/docs/react-component.html#setstate\"\n      }}><inlineCode parentName=\"a\">{`this.setState()`}</inlineCode></a>{` method in class components\nand via the newer `}<a parentName=\"p\" {...{\n        \"href\": \"https://reactjs.org/docs/hooks-reference.html#usestate\"\n      }}><inlineCode parentName=\"a\">{`useState()`}</inlineCode></a>{` hook in function components.\nFor managing global state React also features a lesser known `}<a parentName=\"p\" {...{\n        \"href\": \"https://reactjs.org/docs/context.html\"\n      }}>{`Context API`}</a>{` out of the box.`}</p>\n    <p>{`However, in large applications state management can prove more difficult or inefficient.\nThat's what resulted in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://facebook.github.io/flux/\"\n      }}>{`Flux`}</a>{` architecture for managing data flow and application state in React.\nWhile the original Flux project by Facebook themselves is no longer actively developed, the architecture has proven useful.\nPopular state management libraries of today like `}<a parentName=\"p\" {...{\n        \"href\": \"https://redux.js.org/\"\n      }}>{`Redux`}</a>{` are built upon it.`}</p>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://facebook.github.io/flux/img/overview/flux-simple-f8-diagram-with-client-action-1300w.png\",\n        \"alt\": \"Flux architecture\"\n      }}></img>{`\n`}<em parentName=\"p\">{`Source: Facebook's Flux Docs`}</em></p>\n    <p>{`The Flux pattern traditionally consists of central `}<strong parentName=\"p\">{`Dispatcher`}</strong>{`(s), which can receive so-called Actions.\nAn `}<strong parentName=\"p\">{`Action`}</strong>{` represents a modification of the application's state and has an identifying type (kind) as well as a potential payload of additional data.\nActions may also be viewed as events, which happen within the application.\nThe dispatcher is responsible for forwarding the received data to the relevant `}<strong parentName=\"p\">{`Stores`}</strong>{`.\nEach store is used to store state information relevant to a specific part of the application.\nThis allows to separate for example which application language the user has selected from which chatroom they are currently viewing.`}</p>\n    <p>{`You can read more about the architecture in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://facebook.github.io/flux/docs/in-depth-overview/\"\n      }}>{`In-Depth Overview`}</a>{` within the Flux Docs.`}</p>\n    <p>{`The store data as well as the ability to dispatch actions now has to be made available for UI components.\nFor the classic class-based components, this used to be typically done with wrapper components,\nwhich take care of updating and give the inner component access to store data via props or custom methods.\nThis API is sometimes also referred to as \"Connect\" since the name of the function used to wrap a component usually includes the word connect.\nThe alternative API for function component would be realized via the newer concept of `}<a parentName=\"p\" {...{\n        \"href\": \"https://reactjs.org/docs/hooks-intro.html\"\n      }}>{`hooks`}</a>{`.`}</p>\n    <Banner type=\"info\" mdxType=\"Banner\">\n      <p>{`The React community has been moving more and more towards `}<strong parentName=\"p\">{`function components and hooks`}</strong>{`.\nThey make it easy to use data within a component and have it update automatically.\nLibraries like `}<a parentName=\"p\" {...{\n          \"href\": \"https://react-redux.js.org/\"\n        }}>{`React Redux`}</a>{` are now recommending usage of their hooks API over older class component APIs.`}</p>\n    </Banner>\n    <h2>{`Discord's Flux implementation`}</h2>\n    <p>{`Discord uses a (as far as we know) custom implementation of the Flux architecture.\nIt forms a large part of the data layer behind the UI layer.`}</p>\n    <Banner type=\"warn\" bold mdxType=\"Banner\">While fairly stable in the past, Discord's Flux internals may change just like any other part of the internals.</Banner>\n    <p>{`Their implementation has both a newer hooks API they are transitioning to as well as an old connect API, which is still used in parts of the codebase.\nBoth APIs require the relevant stores in an array and a callback which computes the data and is invoked whenever a change has been detected.\nAll hooks also take an optional dependency array.\nIn the case of `}<inlineCode parentName=\"p\">{`useStateFromStores()`}</inlineCode>{` a comparator function can be passed as 4th argument to customize update behaviour.\nThe `}<inlineCode parentName=\"p\">{`useStateFromStoresArray()`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`useStateFromStoresObject()`}</inlineCode>{` hooks come with a predefined comparator for arrays and objects respectively.`}</p>\n    <CodeTabs names={[\"Hooks\", \"Connect\"]} mdxType=\"CodeTabs\">\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-jsx\"\n        }}>{`const MyComponent = () => {\n    const currentUser = useStateFromStores([UserStore], () => UserStore.getCurrentUser());\n\n    return (\n        <div>Current user is: {currentUser.username}</div>\n    );\n};\n`}</code></pre>\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-jsx\"\n        }}>{`const MyComponent = (props) => (\n    <div>Current user is: {props.currentUser.username}</div>\n);\n\nconst ConnectedMyComponent = Flux.connectStores([UserStore], () => ({\n    currentUser: UserStore.getCurrentUser()\n}))(MyComponent);\n`}</code></pre>\n    </CodeTabs>\n    <p>{`Their stores as well as their central dispatcher also allow for listeners, which are notified of any incoming actions/events.\nThis can be useful when you want to use store updates somewhere outside of the UI layer.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const listener = (action) => console.log(\"Dispatcher received:\", action);\n\nDispatcher.subscribe(\"ACTION_TYPE\", listener);\n\nDispachter.unsubscribe(\"ACTION_TYPE\", listener);\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const listener = () => console.log(\"UserStore was updated\");\n\nUserStore.addChangeListener(listener);\n\nUserStore.removeChangeListener(listener);\n`}</code></pre>\n    <p>{`Besides using the intended functions for dispatching specific actions, actions can also be dispatched directly on the dispatcher using `}<inlineCode parentName=\"p\">{`Dispatcher.dispatch()`}</inlineCode>{`.`}</p>\n    <p>{`There is a massive amount of different actions.\nIn May 2022 nearly 1500 entries were listed within Discord's internal `}<inlineCode parentName=\"p\">{`ActionType`}</inlineCode>{` TypeScript enum.\nThe enum has since been removed (most likely turned into a `}<inlineCode parentName=\"p\">{`const enum`}</inlineCode>{`) in August 2022.`}</p>\n    <h2>{`Finding Stores`}</h2>\n    <p>{`As with all other internals, stores need to be found within the webpack exports cache and have to be reverse engineered.\nYou can find more information in my `}<a parentName=\"p\" {...{\n        \"href\": \"../getting-started\"\n      }}>{`Getting started with BetterDiscord Plugin development`}</a>{` guide.\nIn 2022 Discord added a `}<inlineCode parentName=\"p\">{`getName()`}</inlineCode>{` method to their store class.\nThe name is also present as `}<inlineCode parentName=\"p\">{`displayName`}</inlineCode>{` property on the store constructors.\n`}<em parentName=\"p\">{`(Note: BetterDiscord's `}<inlineCode parentName=\"em\">{`byDisplayName`}</inlineCode>{` filter does not search constructors as of now.)`}</em>{`\nTheoretically you can now find stores using their name rather than interface or other characteristics.\nStore names can also prove useful when figuring out a store's purpose.`}</p>\n    <CodeTabs names={[\"Props\", \"Name\"]} mdxType=\"CodeTabs\">\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}>{`const GuildStore = getModule(Filters.byProps(\"getGuild\"));\nconst ChannelStore = getModule(Filters.byProps(\"getChannel\", \"hasChannel\"));\nconst UserStore = getModule(Filters.byProps(\"getUser\", \"getCurrentUser\"));\n`}</code></pre>\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}>{`const GuildStore = getModule((exports) => exports?.constructor?.displayName === \"GuildStore\");\nconst ChannelStore = getModule((exports) => exports?.constructor?.displayName === \"ChannelStore\");\nconst UserStore = getModule((exports) => exports?.constructor?.displayName === \"UserStore\");\n`}</code></pre>\n    </CodeTabs>\n    <p>{`Usually a good way to start is to look at a part of the UI where data from the store you are searching for is supposedly used.\nGo up the parent chain and try to find the first \"normal\" component whose props do not include the data itself or children with the data already \"rendered\".\nThe relevant stores are most likely accessed within this component.`}</p>\n    <p>{`Alternatively you can attempt taking educated guesses regarding the store's name or methods - either complete or partial, like `}<inlineCode parentName=\"p\">{`name.toLowerCase().includes(\"guild\")`}</inlineCode>{`.`}</p>\n    <p>{`A list of all stores can be retreived by either checking the name or by making sure it is an instance of `}<inlineCode parentName=\"p\">{`Flux.Store`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`getModule(\n    (exports) => typeof exports?.getName === \"function\" && exports.getName().endsWith(\"Store\"),\n    {first: false}\n)\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`getModule((exports) => exports instanceof Flux.Store, {first: false})\n`}</code></pre>\n    <p>{`Note that the first version will be missing a couple of stores which have no name set.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","makeShortcode","name","props","console","warn","Banner","CodeTabs","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","type","bold","names","isMDXComponent"],"sourceRoot":""}